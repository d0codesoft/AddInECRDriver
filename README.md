# Внешняя компонента 1С AddIn для POS Терминала (Эквайрингового терминала)
# Утилита тестирования AddIn 1C 8

**Находится в процессе разработки**

## 📄 Описание

Данная внешняя компонента предназначена для интеграции POS-терминалов (эквайринговых терминалов) с платформой **1С:Предприятие 8.3**. Компонента реализует взаимодействие с терминалами по протоколу ECR (электронный кассовый регистратор) от **PrivatBank**, основанному на формате JSON.  

Подключаемая компонента соответствует стандарту **"Требования к разработке драйверов подключаемого оборудования"**, версия **3.4**, и обеспечивает полный набор методов для интеграции с решениями 1С.

---

## ⚙️ Основные возможности

- ✅ Поддержка протокола ECR от **PrivatBank**  
- 📝 Обмен данными в формате JSON  
- 🔗 Совместимость с платформой **1С:Предприятие 8.3**  
- 💡 Поддержка ключевых методов для интеграции с POS-терминалами  
- 🛡 Подробная обработка ошибок и логирование событий  
- 🌐 Поддержка локализации интерфейса

---

## 📜 Таблица версий и требований к конфигурациям

| Конфигурация                              | Версия конфигурации  | Версия БПО     | Требуемая версия стандарта |
|--------------------------------------------|----------------------:|---------------:|---------------------------:|
| **BAS SmallBusiness**                      | 1.6.X.X             | 2.1.6.16       | 3.4                        |
| **BAS Управление торговлей**               | 3.5.X.X             | 2.1.3.9        | 3.2                        |
| **BAS ERP**                                | 2.5.X.X             | 2.1.3.9        | 3.2                        |

---

## 📚 Используемые внешние библиотеки

- **Boost**:  `1.89`
- **pugixml**: `1.15`

---

## 🖥 Поддерживаемые операционные системы

- **Windows (Server) x64**: версии 7–11, 2019–2022
- **Ubuntu x64**: версия 22.04
- **Debian x64**: последние стабильные релизы
- **macOS**: последние стабильные релизы

---

## 💡 Использование

### 🔄 Инициализация

Для инициализации драйвера необходимо создать экземпляр класса:
```
ПодключитьВнешнююКомпоненту({полный путь}+"\ECR_Driver_PT_win64.dll", "Driver", ТипВнешнейКомпоненты.Native);
ОбъектДрайвера = Новый("AddIn.Driver.ECRDriverPOS");
```

---

### 🔧 Доступные методы

- в процессе разработки

---

### 🏷 Доступные свойства

- в процессе разработки

---

## 📝 Логирование

Логирование ключевых событий и ошибок производится в указанный каталог логов, который задается при инициализации драйвера.

---

# Утилита тестирования AddIn 1C 8

## Обзор
Эта утилита позволяет автоматизированное тестирование компонентов AddIn для 1С:Предприятие 8. Она использует формат скриптов (`.testscript`) для определения тестов, включая вызовы процедур и функций с параметрами и ожидаемыми результатами.

## Формат тестового скрипта
Тестовые скрипты пишутся в формате `ini` и имеют расширение `.testscript`.

### Пример тестового скрипта
```ini
# Название теста
[Test]
Name = "Тестирование подключения POS Terminal Privat JSON"

# Вызовы
# Формат: CallAsFunc <ИмяФункции> | <Количество параметров> | <Параметр0> | <Параметр1> | ... | <ПеременнаяРезультата>, Возможны пустые параметры | |
# Формат: CallAsProc <ИмяПроцедуры> | <Количество параметров> | <Параметр0> | <Параметр1> | ... Возможны пустые параметры | |
[Execute]
CallAsFunc = ПолучитьРевизиюИнтерфейса | 0 | result1
CallAsFunc = ПолучитьОписание | 1 |  | result2
CallAsFunc = ПолучитьПараметры | 1 |  | result3
CallAsFunc = УстановитьПараметр | 2 | Address | "127.0.0.1" | result4
CallAsFunc = УстановитьПараметр | 2 | Port | 2000 | result5
CallAsFunc = УстановитьПараметр | 2 | ConnectionType | 0 | result6
CallAsFunc = УстановитьПараметр | 2 | LogLevel | 1 | result7
CallAsFunc = УстановитьПараметр | 2 | Facepay | false | result8
CallAsFunc = Подключить | 1 |  | statusConnect
CallAsFunc = Отключить | 1 | statusConnect[0] | statusDisconnect


```

## Запуск тестов
```sh
testaddin file_name.dll --deviceType POSTerminal --script my_test.testscript
```

### Ожидаемое поведение
- **Процедуры** вызываются в указанном порядке с переданными параметрами.
- **Функции** выполняются, а их результаты сохраняются в переменные для дальнейшей проверки (пока не сохраняются, но будут).

## Установка

### ✅ 1. Windows (MSYS2 Clang64)
Установите [MSYS2](https://www.msys2.org) и откройте **Clang64 shell**, затем выполните:

```bash
pacman -S --needed     mingw-w64-clang-x86_64-toolchain     mingw-w64-clang-x86_64-cmake     mingw-w64-clang-x86_64-ninja     mingw-w64-clang-x86_64-openssl
```
---

### ✅ 2. Linux (Ubuntu/Debian)
```bash
sudo apt update
sudo apt install -y build-essential cmake ninja-build libssl-dev
```
---

### ✅ 3. macOS (Homebrew)
```bash
brew install llvm cmake ninja openssl
export CC=clang
export CXX=clang++
```
---

## 3. Конфигурация и сборка (пример **Release**)

### 🔹 Windows (MSYS2 Clang64 + Ninja)
```bash
cmake -S . -B build -G "Ninja"     -DCMAKE_BUILD_TYPE=Release     -DVCPKG_TARGET_TRIPLET=x64-mingw-static     -DUSE_SYSTEM_BOOST=ON     -DENABLE_TEST_ADDIN=OFF

cmake --build build
```
---

### 🔹 Linux
```bash
cmake -S . -B build -G Ninja     -DCMAKE_BUILD_TYPE=Release     -DUSE_SYSTEM_BOOST=ON     -DENABLE_TEST_ADDIN=OFF

cmake --build build
```
---

### 🔹 macOS
```bash
cmake -S . -B build -G Ninja     -DCMAKE_BUILD_TYPE=Release     -DUSE_SYSTEM_BOOST=ON     -DENABLE_TEST_ADDIN=OFF

cmake --build build
```
---

**Примечание:** Для Windows используйте MSYS2 Clang64 и Ninja. Для Linux и macOS используйте соответствующие настройки для вашей платформы.

## Участие в разработке
Приветствуются предложения и pull request'ы для улучшения утилиты!

---

## 📜 Лицензия

Проект лицензирован под лицензией **MIT**. Подробности смотрите в файле [LICENSE](LICENSE).

---

## 👨‍💻 Автор

Разработка: **SCODE**  